{% extends "base.html" %}
{% block content %}
    <div class="month">
        <div class="chart">
            <canvas id="months_chart"></canvas>
        </div>
        <div class="statistics">
            <select id="months">
            <option value="01">Januar</option>
            <option value="02">Februar</option>
            <option value="03">März</option>
            <option value="04">April</option>
            <option value="05">Mai</option>
            <option value="06">Juni</option>
            <option value="07">Juli</option>
            <option value="08">August</option>
            <option value="09">September</option>
            <option value="10">Oktober</option>
            <option value="11">November</option>
            <option value="12">Dezember</option>
            </select>
            <label for="drinks"></label>
        </div>

        <div class="information">
            <p>Das sind im A insgesamt X Blister</p>
            <p>Y gespartes CO² &</p>
            <p>Z gespartes Plastik.</p>
        </div>
    </div>

    <div class="year">
        <div class="chart">
            <canvas id="years_chart"></canvas>
        </div>

        <div class="statistics">
            <select id="years">
            <option value="2024">2024</option>
            <option value="2025">2025</option>
            <option value="2026">2026</option>
            <option value="2027">2027</option>
            </select>
        </div>

        <div class="information">
            <p>Das sind im Jahr X insgesamt Y Blister.</p>
            <p>Z gespartes CO² &</p>
            <p>A gespartes Plastik.</p>
        </div>
    </div>
{% endblock %}

{% block additionaljs %}
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/moment@2.29.1/moment.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chartjs-adapter-moment@1.0.0"></script>
    <script>
        const dataset = {
            label: 'Wert pro Tag',
            data: [],
            borderColor: 'rgba(75, 192, 192, 1)',
            backgroundColor: 'rgba(150, 0, 0, 0.2)',
            borderWidth: 2,
            pointRadius: 4,
            pointBackgroundColor: 'rgba(75, 192, 192, 1)',
            fill: true,
            tension: 0.2
        };

        const barconfig = {
            type: "bar",
            data: {
                labels: [],
                datasets: [{
                    ...dataset,
                    backgroundColor: "rgba(150,150,250,0.4)",
                    borderColor: "rgba(200,200,200,1)",
                    borderWidth: 1
                }]
            },
            options: {
                responsive: true,
                scales: {
                    x: {
                        type: "time",
                        time: {
                            unit: "day"
                        },
                        title: {
                            display: true,
                            text: "Datum"
                        }
                    },
                    y: {
                        beginAtZero: true,
                        title: {
                            display: true,
                            text: "Anzahl"
                        }
                    }
                },
                plugins: {
                    legend: {
                        display: false
                    },
                    tooltip: {
                        callbacks: {
                            label: function(context) {
                                return `Wert: ${context.raw}`;
                            }
                        }
                    }
                }
            }
        }

        const months_chart  = new Chart(
            $("#months_chart"),
            barconfig
        );

        function get_statistics() {
            year=$("#years").val()
            // console.log(year)
            month=$("#months").val()
            // console.log(month)
            $.get("/get_statistics?year="+year+"&month="+month, function(response) {
                months_list=response.monthly_statistics.map(items => item[0])
                console.log(months_list)
                months_chart.data.labels=["2024-11-06", "2024-11-07"];
                months_chart.data.datasets[0].data=[3,5];
                months_chart.update();
            });
        };

        $(document).on("change", ".statistics", function() {
            get_statistics();
        });

        $(document).ready(function() {
            let currentYear = new Date().toISOString().slice(0, 4);
            let currentMonth = new Date().toISOString().slice(5, 7);
            // console.log(currentYear)
            // console.log(currentMonth)
            $("#years").val(currentYear)
            $("#months").val(currentMonth)
            get_statistics();
        });
    </script>
{% endblock %}